<!-- Verkaufs-Galerie -->
<div class="sales-gallery">


  <!-- Erweiterte Filter -->
    <div class="content-card">
        <h3>Verf√ºgbare Fische und andere Artikel</h3>
  <div class="advanced-filters" id="advanced-filters" style="display: none;">
    <div class="filter-row">
      <label for="search-fish">üîç Suche:</label>
      <input type="search" id="search-fish" placeholder="Name, Farbe oder Beschreibung...">
    </div>
    <div class="filter-row">
      <label for="status-filter">Status:</label>
      <select id="status-filter" data-status-filter>
        <option value="all">Alle Status</option>
        <option value="available">Verf√ºgbar</option>
        <option value="reserved">Reserviert</option>
        <option value="sold">Verkauft</option>
      </select>
    </div>
    <div class="filter-row">
      <label for="price-range">Max. Preis:</label>
      <input type="range" id="price-range" min="0" max="200" value="200" step="10">
      <span id="price-display">200‚Ç¨</span>
    </div>
    <button class="filter-toggle" onclick="resetAllFilters()">Alle Filter zur√ºcksetzen</button>
  </div>

  <!-- Standard Filter Controls -->
  <div class="filter-controls">
    <button class="filter-btn active" data-filter="all">Alle anzeigen</button>
    <button class="filter-btn" data-filter="male">M√§nnchen</button>
    <button class="filter-btn" data-filter="female">Weibchen</button>
    <button class="filter-btn" data-filter="juvenile">Jungfische</button>
    <button class="filter-btn" data-filter="special-futter">Futter</button>
    <button class="filter-btn" data-filter="special-pflanze">Pflanzen</button>
    <button class="filter-toggle" onclick="toggleAdvancedFilters()">üîß Erweiterte Filter</button>
  </div>

  <!-- Sortier- und Ergebnis-Controls -->
  <div class="sort-controls">
    <div class="results-count">
      <span id="results-count">Lade Fische...</span>
    </div>
    <div class="sort-dropdown">
      <label for="sort-select">Sortieren nach:</label>
      <select id="sort-select">
        <option value="name">Name</option>
        <option value="price-low">Preis (niedrig ‚Üí hoch)</option>
        <option value="price-high">Preis (hoch ‚Üí niedrig)</option>
        <option value="status">Verf√ºgbarkeit</option>
      </select>
    </div>
  </div>
    </div>
  <div class="fish-grid">
    {% for product in site.data.sales %}
    <div class="fish-card {{ product.status }}"
         data-category="{{ product.gender }}"
         data-price="{{ product.price | default: 0 }}"
         data-status="{{ product.status | default: 'sold' }}">
      <div class="fish-image">
        <img src="{{ product.image | relative_url }}" alt="{{ product.name }}" loading="lazy"
             onerror="this.src='/assets/images/placeholder-fish.jpg'">
        <div class="price-tag">{{ product.price }}‚Ç¨</div>
        <div class="status-badge {{ product.status }}">
          {% if product.status == 'available' %}Verf√ºgbar
          {% elsif product.status == 'reserved' %}Reserviert
          {% elsif product.status == 'sold' %}Verkauft
          {% endif %}
        </div>
      </div>
      <div class="fish-info">
        <h4>{{ product.name }}</h4>
        <div class="fish-details">
          <span class="gender {{ product.gender }}">
            {% if product.gender == 'male' %}‚ôÇ M√§nnchen
            {% elsif product.type == 'female' %}‚ôÄ Weibchen
            {% elsif product.type == 'juvenile' %}Jungfisch
            {% elsif product.type == 'food' %}Futter
            {% elsif product.type == 'plant' %}Pflanze
            {% else %}? Artikeltyp unbekannt
            {% endif %}
          </span>
          <span class="age">{{ product.age }}</span>
          <span class="size">{{ product.size }}</span>
          <span class="color">{{ product.color }}</span>
        </div>
        <p class="description">{{ product.description }}</p>
        {% if product.special_notes %}
          <p class="special-notes"><strong>Besonderheit:</strong> {{ product.special_notes }}</p>
        {% endif %}
        <div class="contact-info">
          {% if product.status == 'available' %}
            <button class="interest-btn">Interesse anmelden</button>
            <small>Nur Abholung m√∂glich</small>
          {% elsif product.status == 'reserved' %}
            <button class="interest-btn" disabled>Reserviert</button>
            {% if product.pickup_date %}
              <small>Abholung: {{ product.pickup_date | date: "%d.%m.%Y" }}</small>
            {% endif %}
          {% elsif product.status == 'sold' %}
            <button class="interest-btn" disabled>Verkauft</button>
            {% if product.sold_date %}
              <small>Verkauft am {{ product.sold_date | date: "%d.%m.%Y" }}</small>
            {% endif %}
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Keine Ergebnisse Nachricht -->
  <div class="no-results" id="no-results" style="display: none;">
    <div class="no-results-icon">üê†</div>
    <h3>Keine Fische gefunden</h3>
    <p>Versuche es mit anderen Filtereinstellungen oder schaue sp√§ter wieder vorbei.</p>
    <button class="reset-filters-btn" onclick="showAllFish()">Alle Fische anzeigen</button>
  </div>

<!-- JavaScript f√ºr Filter-Funktionalit√§t -->
<script src="{{ '/assets/js/sales-filter.js' | relative_url }}"></script>
<script>
// Zus√§tzliche JavaScript-Funktionen direkt im HTML
function toggleAdvancedFilters() {
  const advancedFilters = document.getElementById('advanced-filters');
  const isVisible = advancedFilters.style.display !== 'none';
  advancedFilters.style.display = isVisible ? 'none' : 'block';

  const toggleBtn = event.target;
  toggleBtn.textContent = isVisible ? 'üîß Erweiterte Filter' : 'üîß Filter ausblenden';
}

function resetAllFilters() {
  // Filter-Buttons zur√ºcksetzen
  document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelector('[data-filter="all"]').classList.add('active');

  // Eingabefelder zur√ºcksetzen
  document.getElementById('search-fish').value = '';
  document.getElementById('status-filter').value = 'all';
  document.getElementById('price-range').value = '200';
  document.getElementById('price-display').textContent = '200‚Ç¨';
  document.getElementById('sort-select').value = 'name';

  // Alle Fische anzeigen
  showAllFish();
  updateResultsCount();
}

function updateResultsCount() {
  const visibleCards = document.querySelectorAll('.fish-card:not([style*="display: none"])').length;
  const totalCards = document.querySelectorAll('.fish-card').length;
  const resultsCount = document.getElementById('results-count');
  const noResults = document.getElementById('no-results');

  if (visibleCards === 0) {
    resultsCount.textContent = 'Keine Ergebnisse';
    noResults.style.display = 'block';
  } else {
    resultsCount.textContent = `${visibleCards} von ${totalCards} Fischen`;
    noResults.style.display = 'none';
  }
}

// Event Listeners f√ºr erweiterte Funktionen
document.addEventListener('DOMContentLoaded', function() {
  // Preis-Range Display Update
  const priceRange = document.getElementById('price-range');
  const priceDisplay = document.getElementById('price-display');

  if (priceRange && priceDisplay) {
    priceRange.addEventListener('input', function() {
      priceDisplay.textContent = this.value + '‚Ç¨';
    });
  }

  // Sortierung
  const sortSelect = document.getElementById('sort-select');
  if (sortSelect) {
    sortSelect.addEventListener('change', function() {
      const sortValue = this.value;
      if (typeof sortFish === 'function') {
        sortFish(sortValue);
      }
      updateResultsCount();
    });
  }

  // Suche
  const searchInput = document.getElementById('search-fish');
  if (searchInput) {
    let searchTimeout;
    searchInput.addEventListener('input', function() {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        if (typeof searchFish === 'function') {
          searchFish(this.value);
        }
        updateResultsCount();
      }, 300); // Debounce f√ºr bessere Performance
    });
  }

  // Initiale Ergebnis-Z√§hlung
  updateResultsCount();

  // Observer f√ºr dynamische √Ñnderungen
  const observer = new MutationObserver(updateResultsCount);
  const fishGrid = document.querySelector('.fish-grid');
  if (fishGrid) {
    observer.observe(fishGrid, {
      childList: true,
      attributes: true,
      attributeFilter: ['style'],
      subtree: true
    });
  }
});
</script>
